

<!DOCTYPE html>
<html class="no-js">
   <head>
      

<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<meta name="description" content="Documentation for the Ballerina Programming Language">

<meta name="author" content="WSO2, Inc.">

<meta name="keywords" content="ballerinalang, integration, microservices, programming language, cloud native, ballerina language" />

<link rel="shortcut icon" href="/img/favicon.ico">
<title></title>
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-92163714-2"></script>
<!--FB-->
<meta property="og:type"               content="article" />
<meta property="og:title"              content="Ballerina - " />
<meta property="og:description"        content="" />
<meta property="og:image"              content="/img/ballerina-sm-2.jpg" />
<!--TWITTER-->
<meta name="twitter:card" content="summary" />
<meta name="twitter:site" content="@ballerinalang">
<meta name="twitter:creator" content="@ballerinalang">
<meta name="twitter:title" content="Ballerina">
<meta name="twitter:description" content="">
<meta name="twitter:image" content="/img/ballerina-sm-2.jpg">
<meta name="twitter:text:description" content="">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image:width" content="610">
<!--LINKED IN  -->
<meta property='og:title' content="Ballerina"/>
<meta property='og:image' content="/img/ballerina-sm-2.jpg"/>
<meta property='og:description' content=""/>
<script>
   window.dataLayer = window.dataLayer || [];
   function gtag() {
       dataLayer.push(arguments);
   }
   gtag('js', new Date());
   gtag('config', 'UA-92163714-2');
</script>
<!-- Google Tag Manager -->
<script>
   (function(w, d, s, l, i) {
       w[l] = w[l] || [];
       w[l].push({
           'gtm.start': new Date().getTime(),
           event: 'gtm.js'
       });
       var f = d.getElementsByTagName(s)[0],
           j = d.createElement(s),
           dl = l != 'dataLayer' ? '&l=' + l : '';
       j.async = true;
       j.src =
           'https://www.googletagmanager.com/gtm.js?id=' + i + dl;
       f.parentNode.insertBefore(j, f);
   })(window, document, 'script', 'dataLayer', 'GTM-PSL2TX4');
</script>
<!-- End Google Tag Manager -->
<script src="/js/moment-2.22.0/moment.min.js"></script>
<script src="//code.jquery.com/jquery-3.3.1.min.js"></script>
<script>
   var base_url = "";
</script>
<link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<!-- Optional theme -->
<link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap-theme.min.css" integrity="sha384-rHyoN1iRsVXV4nD0JutlnGaslCJuC7uwjduW9SVrLvRYooPp2bWYgmgJQIXwl/Sp" crossorigin="anonymous">
<!-- Latest compiled and minified JavaScript -->
<script src="//maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
<!-- Fonts -->
<link href="https://fonts.googleapis.com/css?family=Roboto:100,100i,300,300i,400,400i,500,500i,700,700i,900,900i&display=swap" rel="stylesheet">
<link type="text/css" rel="stylesheet" href="https://use.typekit.net/son4ymv.css">
<!-- <link rel="stylesheet" href="./js/vs/editor/editor.main.css">-->
<link rel="stylesheet" href="https://use.typekit.net/son4ymv.css" />
<link rel="stylesheet" href="/css/theme.css" type="text/css" />
<link rel="stylesheet" href="/css/theme_extra.css" type="text/css" />
<script type="text/javascript" src="/js/highlight.pack.js"></script>
<script src="/js/ballerina-common.js?100"></script>
<script src="/js/handlebars-4.0.5/handlebars.js"></script>
<script src="https://resources.ballerina.io/js/slackservice.js"></script>
<link rel="stylesheet" href="/css/ballerina-io.css">
<script>
   // Current page data
   var mkdocs_page_name = '"Home"'.replace(/^"|"$/g, '');
   var mkdocs_page_input_path = '"index.md"'.replace(/^"|"$/g, '');
   var mkdocs_page_url = '"/"'.replace(/^"|"$/g, '');
   
   var releaseNoteFilename = 'RELEASE_NOTE.html';

   var nightly_download_url = 'https://product-dist.ballerina.io/nightly';
   var dev_download_url = 'https://product-dist.ballerina.io/dev';
   var base_download_url = 'https://dist.ballerina.io/downloads';
   
   var base_releasenote_url = ''.concat('/downloads/release-notes');
</script>


      <link rel="stylesheet" href="/css/ballerina-io-docs.css?200618">
   </head>
   <body class="cBallerina-io">
      <div class="row cBallerina-io-Nav" id="iMainNavigation">
    <div class="container">
        <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
            <nav class="navbar">
                <div>
                    <div class="navbar-header">
                        <button type="button" class="navbar-toggle collapsed" data-toggle="collapse"
                                data-target="#navbar" aria-expanded="false" aria-controls="navbar">
                            <span class="sr-only">&#9776</span>
                            <span class="icon-bar"></span>
                            <span class="icon-bar"></span>
                            <span class="icon-bar"></span>
                        </button>
                        <a class="cMobileLogo" href="/"><img src="/img/ballerina-logo.svg" alt="Ballerina"/></a>
                    </div>
                    <div id="navbar" class="collapse navbar-collapse">
                        <ul class="nav navbar-nav cTopNav">
                            <li class="active toctree-l1" id="learnli"><a class="cBioTopLink" href="/learn">Learn</a>
                            </li>
                            <li class="active toctree-l1" id="Eventsli"><a class="cBioTopLink" href="/learn/events">Events</a>
                            </li>
                            <li class="toctree-l1"><a class="cBioTopLink" href="https://central.ballerina.io/"
                                                      target="_blank">Central</a></li>
                            <li class="toctree-l1" id="openli"><a class="cBioTopLink" href="/community">Community</a>
                            </li>
                            <li class="toctree-l1" id="helpli"><a class="cBioTopLink" href="https://blog.ballerina.io">Blog</a>
                            </li>
                            <li class="cVersionItem">
                                <div class="cVersionContainer">
                                    <!-- <lable class="cVlable">Version</lable> -->
                                    <select name="versions" id="versions" class="select-css">
                                        <option value="1.2" data-value="latest">v1.2</option>
                                        <option value="1.1">v1.1</option>
                                        <option value="1.0">v1.0</option>
                                        <option value="0.991">v0.991</option>
                                    </select>
                                </div>
                            </li>
                            <li class="cSearchMenu"><form class="cSearch-form-inline"><input id="searchTxt" class="form-control-field" type="search" placeholder="Search" aria-label="Search"><a id="searchBtn" href="#" class="cSearchButton"><img src="/img/search.svg"/></a></form></li>
                        </ul>
                    </div>
                </div>
            </nav>
        </div>
    </div>
</div>

      <div class="row cBallerina-io-Gray-row">
         <div class="container">
            <div class="row">
               <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12 cBallerina-io-Home-Middle-col">
                  <div class="col-xs-12 col-sm-12" style="padding: 0;">
                     <div class="col-md-12 col-lg-10 cBallerina-io-breadcrumbs">
                        <nav class="breadcrumbs bootstrap hidden-sm-down"
  >
  <ul id="breadcrumb-list" class=" cBalleinaBreadcrumbs list-unstyled  wy-breadcrumbs" vocab="http://schema.org/"
    typeof="BreadcrumbList">


    
    <li><a href="/">Home</a></li>
    
    
    <li>/</li>
    <li><a
        href="/0.991/">0.991</a>
    </li>
    
    
    
    <li>/</li>
    <li><a
        href="/0.991/learn/">Learn</a>
    </li>
    
    
    
    <li>/</li> 
    
    

  </ul>
</nav>
<style type="text/css">
  .cBalleinaBreadcrumbs li {
    margin-right: 10px;
  }
</style>
                        <div class="cVersionContainer"></div>
                     </div>
                     <div class="col-md-12 col-lg-2 cBallerina-io-breadcrumbs">
                        <ul class="wy-breadcrumbs">
                           <li class="wy-breadcrumbs-aside">
                              <a class="icon icon-github" target="_blank" href="https://www.github.com/ballerina-platform/ballerina-platform.github.io/blob/master/0.991/learn/how-to-write-secure-ballerina-code.md">Edit on GitHub</a>
                           </li>
                        </ul>
                     </div>
                  </div>
                  <div class="cBlallerina-io-docs-content-container">
                     <div class="wy-nav-content">
                        <div class="rst-content">
                           <div role="main">
                              <div class="section">
                                 <h1 id="how-to-write-secure-ballerina-programs">How to Write Secure Ballerina Programs</h1>

<p>This document demonstrates different security features and controls available within Ballerina, and serves the purpose of providing guidelines on writing secure Ballerina programs.</p>

<h2 id="secure-by-design">Secure by Design</h2>

<p>This approach makes it unnecessary for developers to review best practice coding lists that itemize how to avoid security vulnerabilities. The Ballerina compiler ensures that Ballerina programs do not introduce security vulnerabilities.</p>

<p>A taint analysis mechanism is used to achieve this.</p>

<p>Parameters in function calls can be designated as security-sensitive. The compiler will generate an error if you pass untrusted data (tainted data) into a security-sensitive parameter:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>tainted value passed to sensitive parameter 'sqlQuery'
</code></pre></div></div>

<p>We require developers to explicitly mark all values passed into security-sensitive parameters as ‘trusted’. This explicit check forces developers and code reviewers to verify that the values being passed into the parameter are not vulnerable to a security violation.</p>

<p>Ballerina standard library makes sure untrusted data cannot be used with security sensitive parameters such as SQL queries, file paths, file name, permission flags, request URLs and configuration keys, preventing  vulnerabilities, including:</p>

<ul>
  <li>SQL Injection</li>
  <li>Path Manipulation</li>
  <li>File Manipulation</li>
  <li>Unauthorized File Access</li>
  <li>Unvalidated Redirect (Open Redirect)</li>
</ul>

<h3 id="ensuring-security-of-ballerina-standard-libraries">Ensuring security of Ballerina standard libraries</h3>

<p>Security-sensitive functions and actions of Ballerina standard libraries are annotated with the <code class="highlighter-rouge">@sensitive</code> parameter annotation. This denotes that untrusted (tainted) data should not be passed to the parameter.</p>

<p>For example, the <code class="highlighter-rouge">sqlQuery</code> parameter of the <code class="highlighter-rouge">ballerina/sql</code> <code class="highlighter-rouge">select</code> remote function is annotated as <code class="highlighter-rouge">@sensitive</code>.</p>

<pre><code class="language-ballerina">public remote function select(@sensitive string sqlQuery, typedesc? recordType, 
                              boolean loadToMemory = false, Param... parameters) 
                      returns @tainted table&lt;record {}&gt;|error;
</code></pre>

<p>The following example constructs an SQL query with a tainted argument:</p>

<pre><code class="language-ballerina">import ballerina/mysql;

type ResultStudent record {
    string name;
};

public function main() {

    mysql:Client testDB = new({
       host: "localhost",
       port: 3306
    });

   // Construct student ID based on user input.
   string studentId = "S_" + args[0];

   // Execute select query using the untrusted (tainted) student ID
   var dt = testDB-&gt;select("SELECT NAME FROM STUDENT WHERE ID = " + studentId,
                           ResultStudent);
   testDB.stop();
}
</code></pre>

<p>The Ballerina compiler will generate an error:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>tainted value passed to sensitive parameter 'sqlQuery'
</code></pre></div></div>

<p>In order to compile, the program is modified to use query parameters:</p>

<pre><code class="language-ballerina">sql:Parameter paramId = {sqlType:sql:TYPE_VARCHAR, value:studentId};
var dt = testDB-&gt;select("SELECT NAME FROM STUDENT WHERE ID = ?", ResultStudent,
                        paramId);
</code></pre>

<p>You need to import the <code class="highlighter-rouge">ballerina/sql</code> module to use the <code class="highlighter-rouge">sql:Parameter</code> type.</p>

<p>Command-line arguments passed to Ballerina programs and inputs received through service resources are considered tainted. Additionally, return values of certain functions and actions are marked with the <code class="highlighter-rouge">@tainted</code> annotation to denote that the resulting value should be considered as untrusted data.</p>

<p>For example, the <code class="highlighter-rouge">select</code> remote function of the SQL client connector highlighted above returns a <code class="highlighter-rouge">@tainted table&lt;record {}&gt;</code>. This means that any value read from a database is considered as untrusted.</p>

<p>If the return type is not explicitly annotated, Ballerina will infer the tainted status of the return value. This is done by analyzing how the tainted status of parameters affect the same of the return value.</p>

<h3 id="securely-using-tainted-data-with-security-sensitive-parameters">Securely using tainted data with security-sensitive parameters</h3>

<p>There can be certain situations where a tainted value must be passed into a security-sensitive parameter. In such situations, it is essential to do proper data validation or data sanitization to make sure the input does not result in a security threat. Once proper controls are in place, the <code class="highlighter-rouge">untaint</code> unary expression can be used to denote that the value is trusted:</p>

<pre><code class="language-ballerina">// Execute select query using the untrusted (tainted) student ID
boolean isValid = isNumeric(studentId);
if (isValid) {
   var dt = testDB-&gt;select("SELECT NAME FROM STUDENT WHERE ID = " +
                           untaint studentId, ResultStudent);
}
// ...
</code></pre>

<p>Additionally, return values can be annotated as <code class="highlighter-rouge">@untainted</code>. This denotes that the return value should be trusted (even if the return value is derived from tainted data):</p>

<pre><code class="language-ballerina">// Execute the select query using the untrusted (tainted) student ID
function sanitizeSortColumn (string columnName) returns @untainted string {
   string sanitizedSortColumn = columnName;
   // Insert sanitization logic to ensure that the return value is safe.
   return sanitizedSortColumn;
}
// ...
</code></pre>

<h2 id="securing-passwords-and-secrets">Securing Passwords and Secrets</h2>

<p>Ballerina provides an API to access configuration values from different sources. For more information, see <a href="https://ballerina.io/0.991/learn/by-example/config-api.html">Config Ballerina by Example</a>.</p>

<p>Configuration values containing passwords or secrets should be encrypted. The Ballerina Config API will decrypt such configuration values when being accessed.</p>

<p>Use the following command to encrypt a configuration value:</p>

<pre><code class="language-cmd">$ ballerina encrypt
</code></pre>

<p>The encrypt command will prompt for the plain-text value to be encrypted and an encryption secret.</p>

<pre><code class="language-cmd">$ ballerina encrypt
Enter value:

Enter secret:

Re-enter secret to verify:

Add the following to the runtime config:
@encrypted:{pIQrB9YfCQK1eIWH5d6UaZXA3zr+60JxSBcpa2PY7a8=}

Or add to the runtime command line:
-e&lt;param&gt;=@encrypted:{pIQrB9YfCQK1eIWH5d6UaZXA3zr+60JxSBcpa2PY7a8=}
</code></pre>

<p>Ballerina uses AES, CBC mode with PKCS#5 padding for encryption. The generated encrypted value should be used in place of the plain-text configuration value.</p>

<p>For example, contents of a configuration file that includes a secret value should look as follows:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>api.secret="@encrypted:{pIQrB9YfCQK1eIWH5d6UaZXA3zr+60JxSBcpa2PY7a8=}"
api.provider="not-a-security-sensitive-value"
</code></pre></div></div>

<p>When running a Ballerina program that uses encrypted configuration values, Ballerina will require the secret used during the encryption process to perform the decryption.</p>

<p>Ballerina will first look for a file named <code class="highlighter-rouge">secret.txt</code>. If such file exists, Ballerina will read the decryption secret from the file and immediately remove the file to make sure secret cannot be accessed afterwards. If the secret file is not present, the Ballerina program will prompt for the decryption secret.</p>

<p>The file based approach is useful in automated deployments. The file containing the decryption secret can be deployed along with the Ballerina program. The name and the path of the secret file can be configured using the <code class="highlighter-rouge">ballerina.config.secret</code> runtime parameter:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ballerina run -e ballerina.config.secret=path/to/secret/file \
securing_configuration_values.balx
</code></pre></div></div>

<h2 id="authentication-and-authorization">Authentication and Authorization</h2>

<p>Ballerina HTTP services can be configured to enforce authentication and authorization.</p>

<p>Ballerina supports JWT based authentication and and Basic Authentication. When Basic Authentication is used, user information can be provided through a configuration file.</p>

<p><em>Note: It is a must to use HTTPS when enforcing authentication and authorization checks, to ensure the confidentiality of sensitive authentication data.</em></p>

<h3 id="jwt-based-authentication">JWT Based Authentication</h3>

<p>The security checks enforced by the <code class="highlighter-rouge">http:Listener</code> can be configured using the <code class="highlighter-rouge">http:AuthProvider</code> values.</p>

<p>To configure JWT based authentication <code class="highlighter-rouge">scheme:http:JWT_AUTH</code> should be used. JWT validation requires several additional <code class="highlighter-rouge">http:AuthProvider</code> configurations including:</p>

<ul>
  <li><code class="highlighter-rouge">issuer</code> - The issuer of the JWT.</li>
  <li><code class="highlighter-rouge">audience</code> - The audience value for the current service.</li>
  <li><code class="highlighter-rouge">clockSkew</code> - Clock skew in seconds that can be used to avoid token validation failures due to clock synchronization problems.</li>
  <li><code class="highlighter-rouge">trustStore</code> - A trust store containing trusted public key certificates of issuers (used for signature validation).</li>
  <li><code class="highlighter-rouge">certificateAlias</code> - Alias of the public key certificate.</li>
</ul>

<p>For demonstration purposes we use <code class="highlighter-rouge">ballerinaTruststore.p12</code> included with Ballerina runtime. In a production deployment, the truststore should only contain the public key certificates of the trusted JWT issuers.</p>

<pre><code class="language-ballerina">import ballerina/http;

http:AuthProvider jwtAuthProvider = {
    scheme: http:JWT_AUTH,
    config: {
        issuer: "ballerina",
        audience: ["ballerina.io"],
        clockSkew: 10,
        certificateAlias: "ballerina",
        trustStore: {
            path: "${ballerina.home}/bre/security/ballerinaTruststore.p12",
            password: "ballerina"
        }
    }
};

listener http:Listener secureHelloWorldEp = new(9091, config = {
    authProviders: [jwtAuthProvider],
    secureSocket: {
        keyStore: {
            path: "${ballerina.home}/bre/security/ballerinaKeystore.p12",
            password: "ballerina"
        }
    }
});

@http:ServiceConfig {
    basePath: "/hello"
}
service helloWorld on secureHelloWorldEp {

    @http:ResourceConfig {
        methods: ["GET"],
        path: "/"
    }
    resource function sayHello(http:Caller caller, http:Request req) {
        http:Response resp = new;
        resp.setTextPayload("Hello, World!");
        checkpanic caller-&gt;respond(resp);
    }
}
</code></pre>

<p>When the service is invoked without authentication information, an authentication failure will occur:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>curl -k -v https://localhost:9091/hello

&gt; GET /hello HTTP/1.1
&gt; Host: localhost:9091
&gt; User-Agent: curl/7.47.0
&gt; Accept: */*
&gt; 
&lt; HTTP/1.1 401 Unauthorized
&lt; content-type: text/plain
&lt; 
Authentication failure
</code></pre></div></div>

<p>Since we used JWT authentication scheme, it is now required to send a valid, signed JWT with the HTTP request. Once a request is made with a signed JWT, the service sends a successful response.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>curl -k -v https://localhost:9091/hello -H "Authorization:Bearer eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJiYWxsZXJpbmEiLCJpc3MiOiJiYWxsZXJpbmEiLCJleHAiOjI4MTg0MTUwMTksImlhdCI6MTUyNDU3NTAxOSwianRpIjoiZjVhZGVkNTA1ODVjNDZmMmI4Y2EyMzNkMGMyYTNjOWQiLCJhdWQiOlsiYmFsbGVyaW5hIiwiYmFsbGVyaW5hLm9yZyIsImJhbGxlcmluYS5pbyJdfQ.X2mHWCr8A5UaJFvjSPUammACnTzFsTdre-P5yWQgrwLBmfcpr9JaUuq4sEwp6to3xSKN7u9QKqRLuWH1SlcphDQn6kdF1ZrCgXRQ0HQTilZQU1hllZ4c7yMNtMgMIaPgEBrStLX1Ufr6LpDkTA4VeaPCSqstHt9WbRzIoPQ1fCxjvHBP17ShiGPRza9p_Z4t897s40aQMKbKLqLQ8rEaYAcsoRBXYyUhb_PRS-YZtIdo7iVmkMVFjYjHvmYbpYhNo57Z1Y5dNa8h8-4ON4CXzcJ1RzuyuFVz1a3YL3gWTsiliVmno7vKyRo8utirDRIPi0dPJPuWi2uMtJkqdkpzJQ"

&gt; GET /hello HTTP/1.1
&gt; Host: localhost:9091
&gt; User-Agent: curl/7.47.0
&gt; Accept: */*
&gt; Authorization:Bearer
pbmEiLCJpc3MiOiJiYWxsZXJpbmEiLCJleHAiOjI4MTg0MTUwMTksImlhdCI6MTUyNDU3NTAxOSwian
RpIjoiZjVhZGVkNTA1ODVjNDZmMmI4Y2EyMzNkMGMyYTNjOWQiLCJhdWQiOlsiYmFsbGVyaW5hIiwiY
mFsbGVyaW5hLm9yZyIsImJhbGxlcmluYS5pbyJdfQ.X2mHWCr8A5UaJFvjSPUammACnTzFsTdre-P5y
WQgrwLBmfcpr9JaUuq4sEwp6to3xSKN7u9QKqRLuWH1SlcphDQn6kdF1ZrCgXRQ0HQTilZQU1hllZ4c
7yMNtMgMIaPgEBrStLX1Ufr6LpDkTA4VeaPCSqstHt9WbRzIoPQ1fCxjvHBP17ShiGPRza9p_Z4t897
s40aQMKbKLqLQ8rEaYAcsoRBXYyUhb_PRS-YZtIdo7iVmkMVFjYjHvmYbpYhNo57Z1Y5dNa8h8-4ON4
CXzcJ1RzuyuFVz1a3YL3gWTsiliVmno7vKyRo8utirDRIPi0dPJPuWi2uMtJkqdkpzJQ
&gt;

&lt; HTTP/1.1 200 OK
&lt; content-type: text/plain
&lt; content-length: 13
&lt;
Hello, World!
</code></pre></div></div>

<p>JWT sent in the previous example contains following information:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>{
  "sub": "ballerina",
  "iss": "ballerina",
  "exp": 2818415019,
  "iat": 1524575019,
  "jti": "f5aded50585c46f2b8ca233d0c2a3c9d",
  "aud": [
    "ballerina",
    "Ballerina.org",
    "ballerina.io"
  ]
}
</code></pre></div></div>

<p>The <code class="highlighter-rouge">@http:ServiceConfig</code> annotation and the <code class="highlighter-rouge">@http:ResourceConfig</code> annotation have attributes that can be used to further configure the security enforcements. For example, authentication can be disabled only for a particular service <code class="highlighter-rouge">authConfig</code> attribute of <code class="highlighter-rouge">@http:ServiceConfig</code>:</p>

<pre><code class="language-ballerina">@http:ServiceConfig {
   basePath: "/hello",
   authConfig: {
      authentication: { 
        enabled: false
      }
   }
}
service helloWorld on secureHelloWorldEp {
// ...
</code></pre>

<p>Furthermore, authentication can be disabled only for a particular resource by using <code class="highlighter-rouge">authConfig</code> attribute of <code class="highlighter-rouge">@http:ResourceConfig</code>:</p>

<pre><code class="language-ballerina">@http:ResourceConfig {
   methods: ["GET"],
   path: "/",
   authConfig: {
      authentication: { 
        enabled: false
      }
   }
}
resource function sayHello (http:Caller caller, http:Request req) {
// ...
</code></pre>

<h3 id="jwt-based-authorization">JWT Based Authorization</h3>

<p>Ballerina uses scope-based authorization. The JWT can include scopes that are available for the user. The scopes can then be validated in the Ballerina service. For example, the following service will only allow invocations, if the “hello” scope is available for the user.</p>

<p>Note that the <code class="highlighter-rouge">authConfig</code> attribute of the <code class="highlighter-rouge">@http:ServiceConfig</code> annotation has been modified to enforce the authorization check.</p>

<pre><code class="language-ballerina">import ballerina/http;

http:AuthProvider jwtAuthProvider = {
    scheme: http:JWT_AUTH,
    config: {
        issuer: "ballerina",
        audience: ["ballerina.io"],
        clockSkew: 10,
        certificateAlias: "ballerina",
        trustStore: {
            path: "${ballerina.home}/bre/security/ballerinaTruststore.p12",
            password: "ballerina"
        }
    }
};

listener http:Listener secureHelloWorldEp = new(9091, config = {
        authProviders: [jwtAuthProvider],
        secureSocket: {
            keyStore: {
                path: "${ballerina.home}/bre/security/ballerinaKeystore.p12",
                password: "ballerina"
            }
        }
    });

@http:ServiceConfig {
    basePath: "/hello",
    authConfig: {
        scopes: ["hello"]
    }
}
service helloWorld on secureHelloWorldEp {

    @http:ResourceConfig {
        methods: ["GET"],
        path: "/"
    }
    resource function sayHello(http:Caller caller, http:Request req) {
        http:Response resp = new;
        resp.setTextPayload("Hello, World!");
        checkpanic caller-&gt;respond(resp);
    }
}
</code></pre>

<p>When the service is invoked without the expected scope, an authorization failure will occur:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>curl -k -v https://localhost:9091/hello -H "Authorization:Bearer eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJiYWxsZXJpbmEiLCJpc3MiOiJiYWxsZXJpbmEiLCJleHAiOjI4MTg0MTUwMTksImlhdCI6MTUyNDU3NTAxOSwianRpIjoiZjVhZGVkNTA1ODVjNDZmMmI4Y2EyMzNkMGMyYTNjOWQiLCJhdWQiOlsiYmFsbGVyaW5hIiwiYmFsbGVyaW5hLm9yZyIsImJhbGxlcmluYS5pbyJdfQ.X2mHWCr8A5UaJFvjSPUammACnTzFsTdre-P5yWQgrwLBmfcpr9JaUuq4sEwp6to3xSKN7u9QKqRLuWH1SlcphDQn6kdF1ZrCgXRQ0HQTilZQU1hllZ4c7yMNtMgMIaPgEBrStLX1Ufr6LpDkTA4VeaPCSqstHt9WbRzIoPQ1fCxjvHBP17ShiGPRza9p_Z4t897s40aQMKbKLqLQ8rEaYAcsoRBXYyUhb_PRS-YZtIdo7iVmkMVFjYjHvmYbpYhNo57Z1Y5dNa8h8-4ON4CXzcJ1RzuyuFVz1a3YL3gWTsiliVmno7vKyRo8utirDRIPi0dPJPuWi2uMtJkqdkpzJQ"

&gt; GET /hello HTTP/1.1
&gt; Host: localhost:9091
&gt; User-Agent: curl/7.47.0
&gt; Accept: */*
&gt; Authorization:Bearer eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJiYWxsZXJ
pbmEiLCJpc3MiOiJiYWxsZXJpbmEiLCJleHAiOjI4MTg0MTUwMTksImlhdCI6MTUyNDU3NTAxOSwian
RpIjoiZjVhZGVkNTA1ODVjNDZmMmI4Y2EyMzNkMGMyYTNjOWQiLCJhdWQiOlsiYmFsbGVyaW5hIiwiY
mFsbGVyaW5hLm9yZyIsImJhbGxlcmluYS5pbyJdfQ.X2mHWCr8A5UaJFvjSPUammACnTzFsTdre-P5y
WQgrwLBmfcpr9JaUuq4sEwp6to3xSKN7u9QKqRLuWH1SlcphDQn6kdF1ZrCgXRQ0HQTilZQU1hllZ4c
7yMNtMgMIaPgEBrStLX1Ufr6LpDkTA4VeaPCSqstHt9WbRzIoPQ1fCxjvHBP17ShiGPRza9p_Z4t897
s40aQMKbKLqLQ8rEaYAcsoRBXYyUhb_PRS-YZtIdo7iVmkMVFjYjHvmYbpYhNo57Z1Y5dNa8h8-4ON4
CXzcJ1RzuyuFVz1a3YL3gWTsiliVmno7vKyRo8utirDRIPi0dPJPuWi2uMtJkqdkpzJQ
&gt;

&lt; HTTP/1.1 403 Forbidden
&lt; content-type: text/plain
&lt;
Authorization failure
</code></pre></div></div>

<p>A request with a correct “scope” attribute will result in a successful invocation. An example of a JWT that has the correct “scope” attribute is as follows.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>{
  "sub": "ballerina",
  "iss": "ballerina",
  "exp": 2818415019,
  "iat": 1524575019,
  "jti": "f5aded50585c46f2b8ca233d0c2a3c9d",
  "aud": [
    "ballerina",
    "ballerina.org",
    "ballerina.io"
  ],
  "scope": "hello"
}
</code></pre></div></div>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>curl -k -v https://localhost:9091/hello -H 'Authorization: Bearer eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJiYWxsZXJpbmEiLCJpc3MiOiJiYWxsZXJpbmEiLCJleHAiOjI4MTg0MTUwMTksImlhdCI6MTUyNDU3NTAxOSwianRpIjoiZjVhZGVkNTA1ODVjNDZmMmI4Y2EyMzNkMGMyYTNjOWQiLCJhdWQiOlsiYmFsbGVyaW5hIiwiYmFsbGVyaW5hLm9yZyIsImJhbGxlcmluYS5pbyJdLCJzY29wZSI6ImhlbGxvIn0.bNoqz9_DzgeKSK6ru3DnKL7NiNbY32ksXPYrh6Jp0_O3ST7WfXMs9WVkx6Q2TiYukMAGrnMUFrJnrJvZwC3glAmRBrl4BYCbQ0c5mCbgM9qhhCjC1tBA50rjtLAtRW-JTRpCKS0B9_EmlVKfvXPKDLIpM5hnfhOin1R3lJCPspJ2ey_Ho6fDhsKE3DZgssvgPgI9PBItnkipQ3CqqXWhV-RFBkVBEGPDYXTUVGbXhdNOBSwKw5ZoVJrCUiNG5XD0K4sgN9udVTi3EMKNMnVQaq399k6RYPAy3vIhByS6QZtRjOG8X93WJw-9GLiHvcabuid80lnrs2-mAEcstgiHVw'

&gt; GET /hello HTTP/1.1
&gt; Host: localhost:9091
&gt; User-Agent: curl/7.47.0
&gt; Accept: */*
&gt; Authorization: Bearer eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJiYWxsZX
JpbmEiLCJpc3MiOiJiYWxsZXJpbmEiLCJleHAiOjI4MTg0MTUwMTksImlhdCI6MTUyNDU3NTAxOSwia
nRpIjoiZjVhZGVkNTA1ODVjNDZmMmI4Y2EyMzNkMGMyYTNjOWQiLCJhdWQiOlsiYmFsbGVyaW5hIiwi
YmFsbGVyaW5hLm9yZyIsImJhbGxlcmluYS5pbyJdLCJzY29wZSI6ImhlbGxvIn0.bNoqz9_DzgeKSK6
ru3DnKL7NiNbY32ksXPYrh6Jp0_O3ST7WfXMs9WVkx6Q2TiYukMAGrnMUFrJnrJvZwC3glAmRBrl4BY
CbQ0c5mCbgM9qhhCjC1tBA50rjtLAtRW-JTRpCKS0B9_EmlVKfvXPKDLIpM5hnfhOin1R3lJCPspJ2e
y_Ho6fDhsKE3DZgssvgPgI9PBItnkipQ3CqqXWhV-RFBkVBEGPDYXTUVGbXhdNOBSwKw5ZoVJrCUiNG
5XD0K4sgN9udVTi3EMKNMnVQaq399k6RYPAy3vIhByS6QZtRjOG8X93WJw-9GLiHvcabuid80lnrs2-
mAEcstgiHVw
&gt;

&lt; HTTP/1.1 200 OK
&lt; content-type: text/plain
&lt;
Hello, World!
</code></pre></div></div>

<p>Note that the scopes defined in <code class="highlighter-rouge">@http:ServiceConfig</code> can also be overridden in <code class="highlighter-rouge">@http:ResourceConfig</code>.</p>

<pre><code class="language-ballerina">@http:ResourceConfig {
   methods: ["GET"],
   path: "/",
   authConfig: {
      scopes: ["say-hello"]
   }
}
resource function sayHello (http:Caller caller, http:Request req) {
// ...
</code></pre>

<h3 id="basic-authentication-and-authorization">Basic Authentication and Authorization</h3>

<p>Ballerina supports Basic Authentication for services. The <code class="highlighter-rouge">scheme</code> field of the <code class="highlighter-rouge">http:AuthProvider</code> should be set to <code class="highlighter-rouge">http:BASIC_AUTH</code> in order to enforce Basic Authentication. Since user information is provided using a configuration file, <code class="highlighter-rouge">authStoreProvider</code> should be set to <code class="highlighter-rouge">http:CONFIG_AUTH_STORE</code>.</p>

<pre><code class="language-ballerina">import ballerina/http;

http:AuthProvider basicAuthProvider = {
    scheme: http:BASIC_AUTH,
    authStoreProvider: http:CONFIG_AUTH_STORE
};

listener http:Listener secureHelloWorldEp = new(9091, config = {
        authProviders: [basicAuthProvider],
        secureSocket: {
            keyStore: {
                path: "${ballerina.home}/bre/security/ballerinaKeystore.p12",
                password: "ballerina"
            }
        }
    });

@http:ServiceConfig {
    basePath: "/hello",
    authConfig: {
        scopes: ["hello"]
    }
}
service helloWorld on secureHelloWorldEp {

    @http:ResourceConfig {
        methods: ["GET"],
        path: "/"
    }
    resource function sayHello(http:Caller caller, http:Request req) {
        http:Response resp = new;
        resp.setTextPayload("Hello, World!");
        checkpanic caller-&gt;respond(resp);
    }
}
</code></pre>

<p>To enforce Basic Authentication, users and scopes should be configured through a configuration file. The following example file introduces two users. The ‘generalUser’ has no scopes and the ‘admin’ user has the ‘hello’ scope.</p>

<p><strong>sample-users.toml</strong></p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>["b7a.users"]

["b7a.users.generalUser"]
password="@encrypted:{pIQrB9YfCQK1eIWH5d6UaZXA3zr+60JxSBcpa2PY7a8=}"

["b7a.users.admin"]
password="@encrypted:{pIQrB9YfCQK1eIWH5d6UaZXA3zr+60JxSBcpa2PY7a8=}"
scopes="hello"
</code></pre></div></div>

<p>Restart the service using the following command.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ballerina run --config sample-users.toml basic_auth_sample.bal
</code></pre></div></div>

<p>Since passwords are encrypted, the Config API will request for the decryption key. Use ‘ballerina’ as the decryption key in this sample.</p>

<p>Also, the passwords can be hashed and provided with the configuration file. The following example file introduces three users along with the passwords hashed with <code class="highlighter-rouge">sha256</code>, <code class="highlighter-rouge">sha384</code>, and <code class="highlighter-rouge">sha512</code> hashing algorithms.</p>

<p><strong>sample-users.toml</strong></p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>["b7a.users"]

["b7a.users.userA"]
password="@sha256:{cd2eb0837c9b4c962c22d2ff8b5441b7b45805887f051d39bf133b583baf6860}"

["b7a.users.userB"]
password="@sha384:{1249e15f035ed34786a328d9fdb2689ab24f7c7b253d1b7f66ed92a679d663dd502d7beda59973e8c91a728b929fc8cd}"

["b7a.users.userC"]
password="@sha512:{9057ff1aa9509b2a0af624d687461d2bbeb07e2f37d953b1ce4a9dc921a7f19c45dc35d7c5363b373792add57d0d7dc41596e1c585d6ef7844cdf8ae87af443f}"
</code></pre></div></div>

<p>Once the service is restarted with the first configuration file in place, the ‘generalUser’ will not be able to invoke the service due to authorization failure:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>curl -k -v -u generalUser:password https://localhost:9091/hello

&gt; GET /hello HTTP/1.1
&gt; Host: localhost:9091
&gt; User-Agent: curl/7.47.0
&gt; Accept: */*

&lt; HTTP/1.1 401 Unauthorized
&lt; content-type: text/plain
&lt;
Authorization failure
</code></pre></div></div>

<p>‘Admin’ user will be able to invoke the service:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>curl -k -v -u admin:password https://localhost:9091/hello

&gt; GET /hello HTTP/1.1
&gt; Host: localhost:9091
&gt; User-Agent: curl/7.47.0
&gt; Accept: */*

&lt; HTTP/1.1 200 OK
&lt; content-type: text/plain
&lt;
Hello, World!
</code></pre></div></div>

<h3 id="authenticating-with-downstream-services">Authenticating with Downstream Services</h3>

<p>Ballerina client connectors can be configured to include authentication and authorization information with requests sent to external or downstream services. Downstream services can be authenticated using JWT, OAuth2, or Basic Authentication.</p>

<h4 id="jwt-based-client-authentication">JWT Based Client Authentication</h4>

<p><code class="highlighter-rouge">http:Client</code> client object can be configured to include JWT token as follows:</p>

<pre><code class="language-ballerina">import ballerina/http;

http:AuthProvider jwtAuthProvider = {
    scheme: http:JWT_AUTH,
    config: {
        issuer: "ballerina",
        audience: ["ballerina.io"],
        clockSkew: 10,
        certificateAlias: "ballerina",
        trustStore: {
            path: "${ballerina.home}/bre/security/ballerinaTruststore.p12",
            password: "ballerina"
        }
    }
};

listener http:Listener secureHelloWorldEp = new(9091, config = {
        authProviders: [jwtAuthProvider],
        secureSocket: {
            keyStore: {
                path: "${ballerina.home}/bre/security/ballerinaKeystore.p12",
                password: "ballerina"
            }
        }
    });

http:Client downstreamServiceEP = new("https://localhost:9092", config = {
    auth: {
        scheme: http:JWT_AUTH
    },
    secureSocket: {
        trustStore: {
            path: "${ballerina.home}/bre/security/ballerinaTruststore.p12",
            password: "ballerina"
        }
    }
});

@http:ServiceConfig {
    basePath: "/hello",
    authConfig: {
        scopes: ["hello"]
    }
}
service helloWorld on secureHelloWorldEp {

    @http:ResourceConfig {
        methods: ["GET"],
        path: "/"
    }
    resource function sayHello(http:Caller caller, http:Request req) returns error? {
        http:Response response = check downstreamServiceEP-&gt;get("/update-stats", message = untaint req);
        checkpanic caller-&gt;respond(response);
    }
}

// ----------------------------------------------
// Following code creates the downstream service
// ----------------------------------------------

http:AuthProvider downstreamJwtAuthProvider = {
    scheme: http:JWT_AUTH,
    config: {
        issuer: "ballerina",
        audience: ["ballerina.io"],
        clockSkew: 10,
        certificateAlias: "ballerina",
        trustStore: {
            path: "${ballerina.home}/bre/security/ballerinaTruststore.p12",
            password: "ballerina"
        }
    }
};

listener http:Listener secureUpdateServiceEp = new(9092, config = {
    authProviders: [downstreamJwtAuthProvider],
    secureSocket: {
        keyStore: {
            path: "${ballerina.home}/bre/security/ballerinaKeystore.p12",
            password: "ballerina"
        }
    }
});

@http:ServiceConfig {
    basePath: "/update-stats"
}
service updateService on secureUpdateServiceEp {

    @http:ResourceConfig {
        methods: ["GET"],
        path: "/"
    }
    resource function updateStats(http:Caller caller, http:Request req) {
        http:Response resp = new;
        resp.setTextPayload("Downstream Service Received JWT: " + untaint req.getHeader("Authorization"));
        checkpanic caller-&gt;respond(resp);
    }
}
</code></pre>

<p>Invoking <code class="highlighter-rouge">/hello</code> resource of the service will result in invoking the downstream service exposed through port <code class="highlighter-rouge">9092</code> with the JWT. The response generated by the downstream services confirms that it received the JWT:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>curl -k -v https://localhost:9091/hello -H 'Authorization: Bearer eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJiYWxsZXJpbmEiLCJpc3MiOiJiYWxsZXJpbmEiLCJleHAiOjI4MTg0MTUwMTksImlhdCI6MTUyNDU3NTAxOSwianRpIjoiZjVhZGVkNTA1ODVjNDZmMmI4Y2EyMzNkMGMyYTNjOWQiLCJhdWQiOlsiYmFsbGVyaW5hIiwiYmFsbGVyaW5hLm9yZyIsImJhbGxlcmluYS5pbyJdLCJzY29wZSI6ImhlbGxvIn0.bNoqz9_DzgeKSK6ru3DnKL7NiNbY32ksXPYrh6Jp0_O3ST7WfXMs9WVkx6Q2TiYukMAGrnMUFrJnrJvZwC3glAmRBrl4BYCbQ0c5mCbgM9qhhCjC1tBA50rjtLAtRW-JTRpCKS0B9_EmlVKfvXPKDLIpM5hnfhOin1R3lJCPspJ2ey_Ho6fDhsKE3DZgssvgPgI9PBItnkipQ3CqqXWhV-RFBkVBEGPDYXTUVGbXhdNOBSwKw5ZoVJrCUiNG5XD0K4sgN9udVTi3EMKNMnVQaq399k6RYPAy3vIhByS6QZtRjOG8X93WJw-9GLiHvcabuid80lnrs2-mAEcstgiHVw'

&gt; GET /hello HTTP/1.1
&gt; Host: localhost:9091
&gt; User-Agent: curl/7.60.0
&gt; Accept: */*
&gt; Authorization: Bearer eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJiYWxsZX
JpbmEiLCJpc3MiOiJiYWxsZXJpbmEiLCJleHAiOjI4MTg0MTUwMTksImlhdCI6MTUyNDU3NTAxOSwia
nRpIjoiZjVhZGVkNTA1ODVjNDZmMmI4Y2EyMzNkMGMyYTNjOWQiLCJhdWQiOlsiYmFsbGVyaW5hIiwi
YmFsbGVyaW5hLm9yZyIsImJhbGxlcmluYS5pbyJdLCJzY29wZSI6ImhlbGxvIn0.bNoqz9_DzgeKSK6
ru3DnKL7NiNbY32ksXPYrh6Jp0_O3ST7WfXMs9WVkx6Q2TiYukMAGrnMUFrJnrJvZwC3glAmRBrl4BY
CbQ0c5mCbgM9qhhCjC1tBA50rjtLAtRW-JTRpCKS0B9_EmlVKfvXPKDLIpM5hnfhOin1R3lJCPspJ2e
y_Ho6fDhsKE3DZgssvgPgI9PBItnkipQ3CqqXWhV-RFBkVBEGPDYXTUVGbXhdNOBSwKw5ZoVJrCUiNG
5XD0K4sgN9udVTi3EMKNMnVQaq399k6RYPAy3vIhByS6QZtRjOG8X93WJw-9GLiHvcabuid80lnrs2-
mAEcstgiHVw

&lt; HTTP/1.1 200 OK
&lt; content-type: text/plain
&lt; content-length: 659
&lt;
Downstream Service Received JWT: Bearer eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9.ey
JzdWIiOiJiYWxsZXJpbmEiLCJpc3MiOiJiYWxsZXJpbmEiLCJleHAiOjI4MTg0MTUwMTksImlhdCI6M
TUyNDU3NTAxOSwianRpIjoiZjVhZGVkNTA1ODVjNDZmMmI4Y2EyMzNkMGMyYTNjOWQiLCJhdWQiOlsi
YmFsbGVyaW5hIiwiYmFsbGVyaW5hLm9yZyIsImJhbGxlcmluYS5pbyJdLCJzY29wZSI6ImhlbGxvIn0
.bNoqz9_DzgeKSK6ru3DnKL7NiNbY32ksXPYrh6Jp0_O3ST7WfXMs9WVkx6Q2TiYukMAGrnMUFrJnrJ
vZwC3glAmRBrl4BYCbQ0c5mCbgM9qhhCjC1tBA50rjtLAtRW-JTRpCKS0B9_EmlVKfvXPKDLIpM5hnf
hOin1R3lJCPspJ2ey_Ho6fDhsKE3DZgssvgPgI9PBItnkipQ3CqqXWhV-RFBkVBEGPDYXTUVGbXhdNO
BSwKw5ZoVJrCUiNG5XD0K4sgN9udVTi3EMKNMnVQaq399k6RYPAy3vIhByS6QZtRjOG8X93WJw-9GLi
Hvcabuid80lnrs2-mAEcstgiHVw
</code></pre></div></div>

<p>Even if the current service is configured to use Basic Authentication, Ballerina can be configured to internally generate a new JWT when calling external or downstream services. To do so, it is required to add JWT issuer configuration to the client who is calling to the downstream service as <code class="highlighter-rouge">inferredJwtIssuerConfig</code> configuration:</p>

<pre><code class="language-ballerina">import ballerina/http;

http:AuthProvider basicAuthProvider = {
    scheme: http:BASIC_AUTH,
    authStoreProvider: http:CONFIG_AUTH_STORE
};

listener http:Listener secureHelloWorldEp = new(9091, config = {
    authProviders: [basicAuthProvider],
    secureSocket: {
        keyStore: {
            path: "${ballerina.home}/bre/security/ballerinaKeystore.p12",
            password: "ballerina"
        }
    }
});

http:Client downstreamServiceEP = new("https://localhost:9092", config = {
    auth: {
        scheme: http:JWT_AUTH,
        config: {
            inferredJwtIssuerConfig: {
                issuer: "ballerina",
                audience: ["ballerina.io"],
                keyAlias: "ballerina",
                keyPassword: "ballerina",
                keyStore: {
                    path: "${ballerina.home}/bre/security/ballerinaKeystore.p12",
                    password: "ballerina"
                }
            }
        }
    },
    secureSocket: {
        trustStore: {
            path: "${ballerina.home}/bre/security/ballerinaTruststore.p12",
            password: "ballerina"
        }
    }
});

@http:ServiceConfig {
    basePath: "/hello",
    authConfig: {
        scopes: ["hello"]
    }
}
service helloWorld on secureHelloWorldEp {

    @http:ResourceConfig {
        methods: ["GET"],
        path: "/"
    }
    resource function sayHello(http:Caller caller, http:Request req) returns error? {
        http:Response response = check downstreamServiceEP-&gt;get("/update-stats", message = untaint req);
        checkpanic caller-&gt;respond(response);
    }
}

// ----------------------------------------------
// Following code creates the downstream service
// ----------------------------------------------

http:AuthProvider jwtAuthProvider = {
    scheme: http:JWT_AUTH,
    config: {
        issuer: "ballerina",
        audience: ["ballerina.io"],
        clockSkew: 10,
        certificateAlias: "ballerina",
        trustStore: {
            path: "${ballerina.home}/bre/security/ballerinaTruststore.p12",
            password: "ballerina"
        }
    }
};

listener http:Listener secureUpdateServiceEp = new(9092, config = {
    authProviders: [jwtAuthProvider],
    secureSocket: {
        keyStore: {
            path: "${ballerina.home}/bre/security/ballerinaKeystore.p12",
            password: "ballerina"
        }
    }
});

@http:ServiceConfig {
    basePath: "/update-stats"
}
service updateService on secureUpdateServiceEp {

    @http:ResourceConfig {
        methods: ["GET"],
        path: "/"
    }
    resource function updateStats(http:Caller caller, http:Request req) {
        http:Response resp = new;
        resp.setTextPayload("Downstream Service Received JWT: " + untaint req.getHeader("Authorization"));
        checkpanic caller-&gt;respond(resp);
    }
}
</code></pre>

<p>Start the service using the following command after creating <code class="highlighter-rouge">sample-users.toml</code> with the set of valid users.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ballerina run --config sample-users.toml basic_auth_sample.bal
</code></pre></div></div>

<p>Use ‘ballerina’ as the password to decrypt user passwords, if you are using the <code class="highlighter-rouge">sample-users.toml</code> file provided in this page.</p>

<p>‘Admin’ user will be able to invoke the <code class="highlighter-rouge">/hello</code> resource and invoke the JWT protected downstream service:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>curl -k -v -u admin:password https://localhost:9091/hello

&gt; GET /hello HTTP/1.1
&gt; Host: localhost:9091
&gt; Authorization: Basic YWRtaW46cGFzc3dvcmQ=
&gt; User-Agent: curl/7.60.0
&gt; Accept: */*

&lt; HTTP/1.1 200 OK
&lt; content-type: text/plain
&lt; content-length: 602
&lt;
Downstream Service Received JWT: Bearer eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9.ey
JzdWIiOiJhZG1pbiIsImlzcyI6ImJhbGxlcmluYSIsImV4cCI6MTUyOTQ5MTMyOCwiaWF0IjoxNTI5N
DkxMDI4LCJqdGkiOiI2NDZkZThlYi02Y2QzLTQ3ODUtYmFiYS1lNGI2YWZjZGMyM2MiLCJhdWQiOlsi
YmFsbGVyaW5hLmlvIl19.OBjpINzO63aUZ1brLN4MnNY7AE_yfuFlKaueJtT47__Pknr7A8nimf6DIX
3MtdaK1FAEE02ivlRpS-gtYxARBXyaKZYOxVMLo08px6E6zS5t1KGi6WnSWNE4OtvU13mzGir4S6eKe
rUHiXM8p8EzfCqDU2Nip6PJdCZPwdTr24D8rtMxOdT3-qTj4C6GT3j8TRK6AFGYLcvog2N-5jQVjonV
lWAY-f9UKjjOvsy4h4fvQ-fxwhL6T9WVLruIAXM9mTF4u5WXvMwoid3TNIuyvdFuJaWyVp572hYyGMX
kj_9tUurTgQAw46GyeGeWMENr-JDHSNs1ZV4fbdH_EUlM6Q==
</code></pre></div></div>

<h4 id="oauth2-based-client-authentication">OAuth2 Based Client Authentication</h4>

<p>The <code class="highlighter-rouge">http:Client</code> object can be configured to include the OAuth2-based client authentication with the Password and Client Credentials grant types. Also, with the Direct Token mode, the credentials can be provided manually and after that refreshing is handled internally.</p>

<h5 id="client-credentials-grant-type">Client Credentials Grant Type</h5>
<pre><code class="language-ballerina">http:Client downstreamServiceEP = new("https://localhost:9092", config = {
    auth: {
        scheme: http:OAUTH2,
        config: {
            grantType: http:CLIENT_CREDENTIALS_GRANT,
            config: {
                tokenUrl: "https://localhost:9196/oauth2/token/authorize",
                clientId: "3MVG9YDQS5WtC11paU2WcQjBB3L5w4gz52uriT8ksZ3nUVjKvrfQMrU4uvZohTftxStwNEW4cfStBEGRxRL68",
                clientSecret: "9205371918321623741",
                scopes: ["token-scope1", "token-scope2"]
            }
        }
    },
    secureSocket: {
        trustStore: {
            path: "${ballerina.home}/bre/security/ballerinaTruststore.p12",
            password: "ballerina"
        }
    }
});
</code></pre>

<h5 id="password-grant-type">Password Grant Type</h5>
<pre><code class="language-ballerina">http:Client downstreamServiceEP = new("https://localhost:9092", config = {
    auth: {
        scheme: http:OAUTH2,
        config: {
            grantType: http:PASSWORD_GRANT,
            config: {
                tokenUrl: "https://localhost:9196/oauth2/token/authorize",
                username: "johndoe",
                password: "A3ddj3w",
                clientId: "3MVG9YDQS5WtC11paU2WcQjBB3L5w4gz52uriT8ksZ3nUVjKvrfQMrU4uvZohTftxStwNEW4cfStBEGRxRL68",
                clientSecret: "9205371918321623741",
                scopes: ["token-scope1", "token-scope2"],
                refreshConfig: {
                    refreshUrl: "https://localhost:9196/oauth2/token/refresh",
                    scopes: ["token-scope1", "token-scope2"]
                }
            }
        }
    },
    secureSocket: {
        trustStore: {
            path: "${ballerina.home}/bre/security/ballerinaTruststore.p12",
            password: "ballerina"
        }
    }
});
</code></pre>

<h5 id="direct-token-mode">Direct Token Mode</h5>
<pre><code class="language-ballerina">http:Client downstreamServiceEP = new("https://localhost:9092", config = {
    auth: {
        scheme: http:OAUTH2,
        config: {
            grantType: http:DIRECT_TOKEN,
            config: {
                accessToken: "34060588-dd4e-36a5-ad93-440cc77a1cfb",
                refreshConfig: {
                    refreshToken: "15160398-ae07-71b1-aea1-411ece712e59",
                    refreshUrl: "https://ballerina.io/sample/refresh",
                    clientId: "rgfKVdnMQnJSSr_pKFTxj3apiwYa",
                    clientSecret: "BRebJ0aqfclQB9v7yZwhj0JfW0ga"
                }
            }
        }
    },
    secureSocket: {
        trustStore: {
            path: "${ballerina.home}/bre/security/ballerinaTruststore.p12",
            password: "ballerina"
        }
    }
});
</code></pre>

<h4 id="basic-authentication-based-client-authentication">Basic Authentication Based Client Authentication</h4>

<p><code class="highlighter-rouge">http:Client</code> client object can be configured to include Basic Authentication credentials:</p>

<pre><code class="language-ballerina">http:Client downstreamServiceEP = new("https://localhost:9092", config = {
    auth: {
        scheme: http:BASIC_AUTH,
        config: {
            username: "downstreamServiceUser",
            password: "password"
        }
    },
    secureSocket: {
        trustStore: {
            path: "${ballerina.home}/bre/security/ballerinaTruststore.p12",
            password: "ballerina"
        }
    }
});
</code></pre>

                              </div>
                           </div>
                        </div>
                     </div>
                  </div>
               </div>
            </div>
         </div>
      </div>
      <div id="iBallerinaFooter" class="row cBallerina-io-White-row">
    <div class="container">
    <div class="col-xs-12 col-sm-12 col-md-3 col-lg-3 cBallerina-io-left-col cBallerinaFooterLinks">
        <ul>
            <li><a class="cBioFooterLink" href="/downloads">Download</a></li>
            <li><a class="cBioFooterLink" href="https://github.com/ballerina-lang/ballerina/blob/master/LICENSE">Code License</a></li>
            <li><a class="cBioFooterLink" href="/license-of-site">Site License</a></li>
            <li><a class="cBioFooterLink" href="/terms-of-service">TERMS OF SERVICE</a></li>
            <li><a class="cBioFooterLink" href="/privacy-policy">PRIVACY POLICY</a></li>
            </ul>
        </div>
    <div class="col-xs-12 col-sm-12 col-md-3 col-lg-3 cBallerina-io-middle-col cBallerinaFooterSignUp">
        <div class="cSocialmedia">
            <ul>
                <li>
                    <a class="cBioFooterLink" href="https://github.com/ballerina-platform" target="_blank"><img src="/img/github.svg"/></a>
                    </li>
                <li><a class="cBioFooterLink" href="https://stackoverflow.com/questions/tagged/ballerina" target="_blank"><img src="/img/stackoverflow.svg"/></a></li>
                <li><a class="cBioFooterLink" href="https://twitter.com/ballerinalang" target="_blank"><img src="/img/twitter.svg"/></a></li>
                <li><a class="cBioFooterLink" href="/community/slack/"><img src="/img/slack.svg"/></a></li>
                </ul>
            <div class="pdframe"></div>
            </div>
        </div>
    <div class="col-xs-12 col-sm-10 col-md-6 col-lg-6 cBallerina-io-right-col">
        <p>In the creation of Ballerina, we were inspired by so many technologies. Thank you to all that have come before us (and forgive us if we missed one): Java, Go, C, C++, D, Rust, Haskell, Kotlin, Dart, TypeScript, JavaScript, Python, Perl, Flow, Swift, Elm, RelaxNG, NPM, Crates, Maven, Gradle, Kubernetes, Docker, Envoy, Markdown, GitHub and WSO2.</p></div>
    </div>
</div>

      <script src="/js/theme.js"></script>

      <script>
            $(document).ready(function() {
                     var gitstar = '<iframe id="iGitStarIframe" src="https://ghbtns.com/github-btn.html?user=ballerina-platform&repo=ballerina-lang&type=star&count=true&size=small" frameborder="0" scrolling="0"></iframe>';
                     $('[data-button="iGitStarText"]').replaceWith(gitstar);
         
                     var gitwatch = '<iframe id="iGitWatchIframe" src="https://ghbtns.com/github-btn.html?user=ballerina-platform&repo=ballerina-lang&type=watch&count=true&size=lsmalle&v=2" frameborder="0" scrolling="0"></iframe>';
                     $('[data-button="iGitWatchText"]').replaceWith(gitwatch);
         
             });
            </script>
         
            <style>
                .cGitButtonContainer {
                    display: inline-block;
                    width: 100%;
                    margin-bottom: 0px;
                }
         
                 #iGitStarText {
                     height: 20px;
                     float: left;
                     padding: 0;
                     margin: 0;
                 }
                #iGitStarIframe , #iGitWatchIframe {
                     height: 20px;
                     width: 100px;
                     float: left;
                 }
             </style>

   </body>
</html>

